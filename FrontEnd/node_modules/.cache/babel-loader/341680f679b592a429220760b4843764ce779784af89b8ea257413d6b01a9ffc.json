{"ast":null,"code":"import { initializeApp } from 'firebase/app';\nimport { getMessaging, getToken as getFirebaseToken, onMessage } from 'firebase/messaging';\nimport { firebaseConfig } from './firebaseConfig';\nconst sendTokenToServer = async token => {\n  try {\n    await fetch('http://localhost:5000/api/events/saveToken', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        token\n      })\n    });\n  } catch (error) {\n    console.error('Error sending token to server:', error);\n  }\n};\n// Initialize Firebase app\nconst app = initializeApp(firebaseConfig);\nconst messaging = getMessaging(app);\nexport const setupNotifications = callback => {\n  onMessage(messaging, payload => {\n    console.log('Message received. ', payload); // Debugging line\n    callback(payload);\n  });\n};\nexport const getToken = async () => {\n  try {\n    const currentToken = localStorage.getItem('fcmToken');\n    if (currentToken) {\n      console.log('FCM Token from localStorage:', currentToken);\n      return currentToken;\n    } else {\n      const permission = await Notification.requestPermission();\n      if (permission === 'granted') {\n        console.log('Notification permission granted.');\n        const token = await getFirebaseToken(messaging, {\n          vapidKey: process.env.REACT_APP_FIREBASE_API_KEY\n        });\n        if (token) {\n          console.log('FCM Token:', token);\n          localStorage.setItem('fcmToken', token);\n          await sendTokenToServer(token);\n          return token;\n        } else {\n          console.log('Failed to get FCM token.');\n          return null;\n        }\n      } else {\n        console.log('Notification permission not granted.');\n        return null;\n      }\n    }\n  } catch (error) {\n    console.error('Error getting FCM token:', error);\n    return null;\n  }\n};\nexport const checkNotificationPermission = async () => {\n  if (Notification.permission === 'default') {\n    const permission = await Notification.requestPermission();\n    return permission === 'granted';\n  }\n  return Notification.permission === 'granted';\n};","map":{"version":3,"names":["initializeApp","getMessaging","getToken","getFirebaseToken","onMessage","firebaseConfig","sendTokenToServer","token","fetch","method","headers","body","JSON","stringify","error","console","app","messaging","setupNotifications","callback","payload","log","currentToken","localStorage","getItem","permission","Notification","requestPermission","vapidKey","process","env","REACT_APP_FIREBASE_API_KEY","setItem","checkNotificationPermission"],"sources":["/home/rguktrkvalley/rgukt-event-management/src/firebase.js"],"sourcesContent":["import { initializeApp } from 'firebase/app';\nimport { getMessaging, getToken as getFirebaseToken, onMessage } from 'firebase/messaging';\nimport { firebaseConfig } from './firebaseConfig';\n\n\nconst sendTokenToServer = async (token) => {\n  try {\n    await fetch('http://localhost:5000/api/events/saveToken', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ token }),\n    });\n  } catch (error) {\n    console.error('Error sending token to server:', error);\n  }\n};\n// Initialize Firebase app\nconst app = initializeApp(firebaseConfig);\nconst messaging = getMessaging(app);\n\nexport const setupNotifications = (callback) => {\n  onMessage(messaging, (payload) => {\n    console.log('Message received. ', payload); // Debugging line\n    callback(payload);\n  });\n};\n\nexport const getToken = async () => {\n  try {\n    const currentToken = localStorage.getItem('fcmToken');\n    if (currentToken) {\n      console.log('FCM Token from localStorage:', currentToken);\n      return currentToken;\n    } else {\n      const permission = await Notification.requestPermission();\n      if (permission === 'granted') {\n        console.log('Notification permission granted.');\n\n        const token = await getFirebaseToken(messaging, { vapidKey: process.env.REACT_APP_FIREBASE_API_KEY });\n        if (token) {\n          console.log('FCM Token:', token);\n          localStorage.setItem('fcmToken', token);\n          await sendTokenToServer(token);\n          return token;\n        } else {\n          console.log('Failed to get FCM token.');\n          return null;\n        }\n      } else {\n        console.log('Notification permission not granted.');\n        return null;\n      }\n    }\n  } catch (error) {\n    console.error('Error getting FCM token:', error);\n    return null;\n  }\n};\nexport const checkNotificationPermission = async () => {\n    if (Notification.permission === 'default') {\n      const permission = await Notification.requestPermission();\n      return permission === 'granted';\n    }\n    return Notification.permission === 'granted';\n  };\n  \n"],"mappings":"AAAA,SAASA,aAAa,QAAQ,cAAc;AAC5C,SAASC,YAAY,EAAEC,QAAQ,IAAIC,gBAAgB,EAAEC,SAAS,QAAQ,oBAAoB;AAC1F,SAASC,cAAc,QAAQ,kBAAkB;AAGjD,MAAMC,iBAAiB,GAAG,MAAOC,KAAK,IAAK;EACzC,IAAI;IACF,MAAMC,KAAK,CAAC,4CAA4C,EAAE;MACxDC,MAAM,EAAE,MAAM;MACdC,OAAO,EAAE;QAAE,cAAc,EAAE;MAAmB,CAAC;MAC/CC,IAAI,EAAEC,IAAI,CAACC,SAAS,CAAC;QAAEN;MAAM,CAAC;IAChC,CAAC,CAAC;EACJ,CAAC,CAAC,OAAOO,KAAK,EAAE;IACdC,OAAO,CAACD,KAAK,CAAC,gCAAgC,EAAEA,KAAK,CAAC;EACxD;AACF,CAAC;AACD;AACA,MAAME,GAAG,GAAGhB,aAAa,CAACK,cAAc,CAAC;AACzC,MAAMY,SAAS,GAAGhB,YAAY,CAACe,GAAG,CAAC;AAEnC,OAAO,MAAME,kBAAkB,GAAIC,QAAQ,IAAK;EAC9Cf,SAAS,CAACa,SAAS,EAAGG,OAAO,IAAK;IAChCL,OAAO,CAACM,GAAG,CAAC,oBAAoB,EAAED,OAAO,CAAC,CAAC,CAAC;IAC5CD,QAAQ,CAACC,OAAO,CAAC;EACnB,CAAC,CAAC;AACJ,CAAC;AAED,OAAO,MAAMlB,QAAQ,GAAG,MAAAA,CAAA,KAAY;EAClC,IAAI;IACF,MAAMoB,YAAY,GAAGC,YAAY,CAACC,OAAO,CAAC,UAAU,CAAC;IACrD,IAAIF,YAAY,EAAE;MAChBP,OAAO,CAACM,GAAG,CAAC,8BAA8B,EAAEC,YAAY,CAAC;MACzD,OAAOA,YAAY;IACrB,CAAC,MAAM;MACL,MAAMG,UAAU,GAAG,MAAMC,YAAY,CAACC,iBAAiB,CAAC,CAAC;MACzD,IAAIF,UAAU,KAAK,SAAS,EAAE;QAC5BV,OAAO,CAACM,GAAG,CAAC,kCAAkC,CAAC;QAE/C,MAAMd,KAAK,GAAG,MAAMJ,gBAAgB,CAACc,SAAS,EAAE;UAAEW,QAAQ,EAAEC,OAAO,CAACC,GAAG,CAACC;QAA2B,CAAC,CAAC;QACrG,IAAIxB,KAAK,EAAE;UACTQ,OAAO,CAACM,GAAG,CAAC,YAAY,EAAEd,KAAK,CAAC;UAChCgB,YAAY,CAACS,OAAO,CAAC,UAAU,EAAEzB,KAAK,CAAC;UACvC,MAAMD,iBAAiB,CAACC,KAAK,CAAC;UAC9B,OAAOA,KAAK;QACd,CAAC,MAAM;UACLQ,OAAO,CAACM,GAAG,CAAC,0BAA0B,CAAC;UACvC,OAAO,IAAI;QACb;MACF,CAAC,MAAM;QACLN,OAAO,CAACM,GAAG,CAAC,sCAAsC,CAAC;QACnD,OAAO,IAAI;MACb;IACF;EACF,CAAC,CAAC,OAAOP,KAAK,EAAE;IACdC,OAAO,CAACD,KAAK,CAAC,0BAA0B,EAAEA,KAAK,CAAC;IAChD,OAAO,IAAI;EACb;AACF,CAAC;AACD,OAAO,MAAMmB,2BAA2B,GAAG,MAAAA,CAAA,KAAY;EACnD,IAAIP,YAAY,CAACD,UAAU,KAAK,SAAS,EAAE;IACzC,MAAMA,UAAU,GAAG,MAAMC,YAAY,CAACC,iBAAiB,CAAC,CAAC;IACzD,OAAOF,UAAU,KAAK,SAAS;EACjC;EACA,OAAOC,YAAY,CAACD,UAAU,KAAK,SAAS;AAC9C,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}