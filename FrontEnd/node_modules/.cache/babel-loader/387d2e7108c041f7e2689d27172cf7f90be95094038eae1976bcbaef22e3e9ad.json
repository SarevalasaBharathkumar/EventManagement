{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Button,Card,Modal,Form}from'react-bootstrap';import axios from'axios';import'./FeedbackAnalytics.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const FeedbackAnalytics=()=>{const[completedEvents,setCompletedEvents]=useState([]);const[showFeedbackForm,setShowFeedbackForm]=useState(false);const[selectedEventId,setSelectedEventId]=useState(null);const[rating,setRating]=useState(0);const[textFeedback,setTextFeedback]=useState('');let[feedbackAlreadySubmitted,setFeedbackAlreadySubmitted]=useState({});useEffect(()=>{fetchCompletedEvents();},[]);const fetchCompletedEvents=async()=>{try{const response=await axios.get('http://localhost:5000/api/feedback/completedEvents');const{completedEvents}=response.data;const userData=JSON.parse(localStorage.getItem('userData'));const email=userData[0];const eventsWithFeedbackStatus=await Promise.all(completedEvents.map(async event=>{try{const feedbackResponse=await axios.get(`http://localhost:5000/api/feedback/checkFeedback/${event._id}/${email}`);const feedbackExists=feedbackResponse.data.feedbackExists;return{...event,feedbackAlreadySubmitted:feedbackExists};}catch(error){console.error(`Error checking feedback for event ${event._id}:`,error);return{...event,feedbackAlreadySubmitted:false};}}));setCompletedEvents(eventsWithFeedbackStatus);}catch(error){console.error('Error fetching completed events:',error);}};const handleAddFeedback=eventId=>{setSelectedEventId(eventId);setShowFeedbackForm(true);};const handleFeedbackFormSubmit=async e=>{e.preventDefault();if(rating<1||rating>5){alert('Rating must be between 1 and 5.');return;}const userData=JSON.parse(localStorage.getItem('userData'));const email=userData[0];const newFeedback={eventId:selectedEventId,email,rating,text:textFeedback};try{await axios.post('http://localhost:5000/api/feedback/submitFeedback',newFeedback);alert('Feedback submitted successfully');setShowFeedbackForm(false);resetFeedbackForm();setFeedbackAlreadySubmitted(prevState=>({...prevState,[selectedEventId]:true}));setCompletedEvents(prevEvents=>prevEvents.map(event=>event._id===selectedEventId?{...event,feedbackAlreadySubmitted:true}:event));}catch(error){console.error('Error submitting feedback:',error);}};const resetFeedbackForm=()=>{setRating(0);setTextFeedback('');};return/*#__PURE__*/_jsxs(\"div\",{className:\"feedback-container mt-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"feed_heading\",children:\"Completed Events for Feedback\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"div\",{className:\"event-cards-container\",children:completedEvents.map((event,index)=>/*#__PURE__*/_jsxs(Card,{className:\"event-card\",children:[event.imageUrl&&/*#__PURE__*/_jsx(Card.Img,{variant:\"top\",src:event.imageUrl,alt:event.eventName,className:\"card-img-top\"}),/*#__PURE__*/_jsxs(Card.Body,{className:\"d-flex flex-column\",children:[/*#__PURE__*/_jsx(Card.Title,{children:event.eventName}),event.feedbackAlreadySubmitted?/*#__PURE__*/_jsx(Button,{variant:\"success\",disabled:true,children:\"Feedback Submitted\"}):/*#__PURE__*/_jsx(Button,{variant:\"primary\",onClick:()=>handleAddFeedback(event._id),children:\"Add Feedback\"})]})]},index))}),/*#__PURE__*/_jsxs(Modal,{show:showFeedbackForm,onHide:()=>setShowFeedbackForm(false),children:[/*#__PURE__*/_jsx(Modal.Header,{closeButton:true,children:/*#__PURE__*/_jsx(Modal.Title,{children:\"Add Feedback\"})}),/*#__PURE__*/_jsx(Modal.Body,{children:/*#__PURE__*/_jsxs(Form,{onSubmit:handleFeedbackFormSubmit,children:[/*#__PURE__*/_jsxs(Form.Group,{controlId:\"rating\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Rating (1-5)\"}),/*#__PURE__*/_jsx(Form.Control,{type:\"number\",min:\"1\",max:\"5\",value:rating,onChange:e=>setRating(parseInt(e.target.value)),required:true})]}),/*#__PURE__*/_jsxs(Form.Group,{controlId:\"textFeedback\",children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Text Feedback (Max 30 characters)\"}),/*#__PURE__*/_jsx(Form.Control,{as:\"textarea\",rows:3,maxLength:30,value:textFeedback,onChange:e=>setTextFeedback(e.target.value),required:true})]}),/*#__PURE__*/_jsx(Button,{variant:\"primary\",type:\"submit\",children:\"Submit Feedback\"})]})})]})]});};export default FeedbackAnalytics;","map":{"version":3,"names":["React","useState","useEffect","Button","Card","Modal","Form","axios","jsx","_jsx","jsxs","_jsxs","FeedbackAnalytics","completedEvents","setCompletedEvents","showFeedbackForm","setShowFeedbackForm","selectedEventId","setSelectedEventId","rating","setRating","textFeedback","setTextFeedback","feedbackAlreadySubmitted","setFeedbackAlreadySubmitted","fetchCompletedEvents","response","get","data","userData","JSON","parse","localStorage","getItem","email","eventsWithFeedbackStatus","Promise","all","map","event","feedbackResponse","_id","feedbackExists","error","console","handleAddFeedback","eventId","handleFeedbackFormSubmit","e","preventDefault","alert","newFeedback","text","post","resetFeedbackForm","prevState","prevEvents","className","children","index","imageUrl","Img","variant","src","alt","eventName","Body","Title","disabled","onClick","show","onHide","Header","closeButton","onSubmit","Group","controlId","Label","Control","type","min","max","value","onChange","parseInt","target","required","as","rows","maxLength"],"sources":["/home/rguktrkvalley/rgukt-event-management/src/components/FeedbackAnalytics.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { Button, Card, Modal, Form } from 'react-bootstrap';\nimport axios from 'axios';\nimport './FeedbackAnalytics.css';\n\nconst FeedbackAnalytics = () => {\n  const [completedEvents, setCompletedEvents] = useState([]);\n  const [showFeedbackForm, setShowFeedbackForm] = useState(false);\n  const [selectedEventId, setSelectedEventId] = useState(null);\n  const [rating, setRating] = useState(0);\n  const [textFeedback, setTextFeedback] = useState('');\n  let [feedbackAlreadySubmitted, setFeedbackAlreadySubmitted] = useState({});\n\n  useEffect(() => {\n    fetchCompletedEvents();\n  }, []);\n\n  const fetchCompletedEvents = async () => {\n    try {\n      const response = await axios.get('http://localhost:5000/api/feedback/completedEvents');\n      const { completedEvents } = response.data;\n\n      const userData = JSON.parse(localStorage.getItem('userData'));\n      const email = userData[0];\n\n      const eventsWithFeedbackStatus = await Promise.all(\n        completedEvents.map(async (event) => {\n          try {\n            const feedbackResponse = await axios.get(`http://localhost:5000/api/feedback/checkFeedback/${event._id}/${email}`);\n            const feedbackExists = feedbackResponse.data.feedbackExists;\n            return {\n              ...event,\n              feedbackAlreadySubmitted: feedbackExists,\n            };\n          } catch (error) {\n            console.error(`Error checking feedback for event ${event._id}:`, error);\n            return {\n              ...event,\n              feedbackAlreadySubmitted: false,\n            };\n          }\n        })\n      );\n\n      setCompletedEvents(eventsWithFeedbackStatus);\n    } catch (error) {\n      console.error('Error fetching completed events:', error);\n    }\n  };\n\n  const handleAddFeedback = (eventId) => {\n    setSelectedEventId(eventId);\n    setShowFeedbackForm(true);\n  };\n\n  const handleFeedbackFormSubmit = async (e) => {\n    e.preventDefault();\n    if (rating < 1 || rating > 5) {\n      alert('Rating must be between 1 and 5.');\n      return;\n    }\n    const userData = JSON.parse(localStorage.getItem('userData'));\n    const email = userData[0];\n    const newFeedback = {\n      eventId: selectedEventId,\n      email,\n      rating,\n      text: textFeedback,\n    };\n    try {\n      await axios.post('http://localhost:5000/api/feedback/submitFeedback', newFeedback);\n      alert('Feedback submitted successfully');\n      setShowFeedbackForm(false);\n      resetFeedbackForm();\n      setFeedbackAlreadySubmitted((prevState) => ({\n        ...prevState,\n        [selectedEventId]: true,\n      }));\n      setCompletedEvents((prevEvents) =>\n        prevEvents.map((event) =>\n          event._id === selectedEventId ? { ...event, feedbackAlreadySubmitted: true } : event\n        )\n      );\n    } catch (error) {\n      console.error('Error submitting feedback:', error);\n    }\n  };\n  const resetFeedbackForm = () => {\n    setRating(0);\n    setTextFeedback('');\n  };\n\n  return (\n    <div className=\"feedback-container mt-4\">\n      <div className=\"feed_heading\">Completed Events for Feedback</div>\n      <br/>\n      <div className=\"event-cards-container\">\n        {completedEvents.map((event, index) => (\n          <Card key={index} className=\"event-card\">\n            {event.imageUrl && (\n              <Card.Img variant=\"top\" src={event.imageUrl} alt={event.eventName} className=\"card-img-top\" />\n            )}\n            <Card.Body className=\"d-flex flex-column\">\n              <Card.Title>{event.eventName}</Card.Title>\n              {event.feedbackAlreadySubmitted ? (\n                <Button variant=\"success\" disabled>\n                  Feedback Submitted\n                </Button>\n              ) : (\n                <Button variant=\"primary\" onClick={() => handleAddFeedback(event._id)}>\n                  Add Feedback\n                </Button>\n              )}\n            </Card.Body>\n          </Card>\n        ))}\n      </div>\n\n      <Modal show={showFeedbackForm} onHide={() => setShowFeedbackForm(false)}>\n        <Modal.Header closeButton>\n          <Modal.Title>Add Feedback</Modal.Title>\n        </Modal.Header>\n        <Modal.Body>\n          <Form onSubmit={handleFeedbackFormSubmit}>\n            <Form.Group controlId=\"rating\">\n              <Form.Label>Rating (1-5)</Form.Label>\n              <Form.Control\n                type=\"number\"\n                min=\"1\"\n                max=\"5\"\n                value={rating}\n                onChange={(e) => setRating(parseInt(e.target.value))}\n                required\n              />\n            </Form.Group>\n\n            <Form.Group controlId=\"textFeedback\">\n              <Form.Label>Text Feedback (Max 30 characters)</Form.Label>\n              <Form.Control\n                as=\"textarea\"\n                rows={3}\n                maxLength={30}\n                value={textFeedback}\n                onChange={(e) => setTextFeedback(e.target.value)}\n                required\n              />\n            </Form.Group>\n\n            <Button variant=\"primary\" type=\"submit\">\n              Submit Feedback\n            </Button>\n          </Form>\n        </Modal.Body>\n      </Modal>\n    </div>\n  );\n};\n\nexport default FeedbackAnalytics;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}